<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 400">
  <!-- Título -->
  <text x="450" y="30" font-family="Arial, sans-serif" font-size="20" font-weight="bold" text-anchor="middle">
    El Puntero FILE*: Conexión entre Programa y Archivo
  </text>
  
  <!-- Programa -->
  <g id="programa">
    <rect x="50" y="80" width="200" height="260" fill="#E3F2FD" stroke="#1976D2" stroke-width="2" rx="8"/>
    <text x="150" y="105" font-family="Arial, sans-serif" font-size="15" font-weight="bold" text-anchor="middle">
      Tu Programa en C
    </text>
    
    <!-- Código -->
    <rect x="70" y="120" width="160" height="90" fill="white" stroke="#666" stroke-width="1" rx="3"/>
    <text x="80" y="140" font-family="monospace" font-size="11">
      FILE *archivo;
    </text>
    <text x="80" y="156" font-family="monospace" font-size="11">
      archivo = fopen(
    </text>
    <text x="90" y="172" font-family="monospace" font-size="11">
        "datos.txt",
    </text>
    <text x="90" y="188" font-family="monospace" font-size="11">
        "r"
    </text>
    <text x="80" y="204" font-family="monospace" font-size="11">
      );
    </text>
    
    <!-- Puntero FILE* -->
    <rect x="70" y="225" width="160" height="100" fill="#C8E6C9" stroke="#2E7D32" stroke-width="2" rx="5"/>
    <text x="150" y="245" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle">
      archivo (FILE*)
    </text>
    <text x="150" y="265" font-family="Arial, sans-serif" font-size="11" text-anchor="middle">
      "Manija" o "Handle"
    </text>
    <text x="150" y="285" font-family="Arial, sans-serif" font-size="11" text-anchor="middle">
      Apunta a estructura
    </text>
    <text x="150" y="300" font-family="Arial, sans-serif" font-size="11" text-anchor="middle">
      FILE en memoria
    </text>
    <text x="150" y="315" font-family="monospace" font-size="10" text-anchor="middle" fill="#1B5E20">
      (dirección 0xABCD)
    </text>
  </g>
  
  <!-- Flecha a Estructura FILE -->
  <path d="M 250 275 L 340 275" stroke="#2E7D32" stroke-width="3" marker-end="url(#arrow-green)"/>
  
  <!-- Estructura FILE en memoria -->
  <g id="estructura-file">
    <rect x="350" y="80" width="200" height="260" fill="#FFF3E0" stroke="#F57C00" stroke-width="2" rx="8"/>
    <text x="450" y="105" font-family="Arial, sans-serif" font-size="15" font-weight="bold" text-anchor="middle">
      Estructura FILE
    </text>
    <text x="450" y="120" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#666">
      (Opaca, gestionada por stdio.h)
    </text>
    
    <!-- Contenido de la estructura -->
    <rect x="365" y="135" width="170" height="190" fill="white" stroke="#666" stroke-width="1" rx="3"/>
    
    <g transform="translate(370, 145)">
      <text x="0" y="15" font-family="Arial, sans-serif" font-size="11" font-weight="bold">
        📋 Descriptor de archivo
      </text>
      <text x="10" y="30" font-family="Arial, sans-serif" font-size="10" fill="#666">
        (ID del SO)
      </text>
      
      <line x1="0" y1="40" x2="160" y2="40" stroke="#DDD" stroke-width="1"/>
      
      <text x="0" y="60" font-family="Arial, sans-serif" font-size="11" font-weight="bold">
        💾 Búfer de E/S
      </text>
      <text x="10" y="75" font-family="Arial, sans-serif" font-size="10" fill="#666">
        (Optimización)
      </text>
      
      <line x1="0" y1="85" x2="160" y2="85" stroke="#DDD" stroke-width="1"/>
      
      <text x="0" y="105" font-family="Arial, sans-serif" font-size="11" font-weight="bold">
        🎯 Posición actual
      </text>
      <text x="10" y="120" font-family="Arial, sans-serif" font-size="10" fill="#666">
        (Cursor en archivo)
      </text>
      
      <line x1="0" y1="130" x2="160" y2="130" stroke="#DDD" stroke-width="1"/>
      
      <text x="0" y="150" font-family="Arial, sans-serif" font-size="11" font-weight="bold">
        🚦 Flags de estado
      </text>
      <text x="10" y="165" font-family="Arial, sans-serif" font-size="10" fill="#666">
        (EOF, error, etc.)
      </text>
    </g>
  </g>
  
  <!-- Flecha al archivo físico -->
  <path d="M 550 275 L 640 275" stroke="#F57C00" stroke-width="3" marker-end="url(#arrow-orange)"/>
  
  <!-- Archivo físico -->
  <g id="archivo-fisico">
    <rect x="650" y="80" width="200" height="260" fill="#E8F5E9" stroke="#2E7D32" stroke-width="2" rx="8"/>
    <text x="750" y="105" font-family="Arial, sans-serif" font-size="15" font-weight="bold" text-anchor="middle">
      Archivo Físico
    </text>
    <text x="750" y="120" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#666">
      (En disco: datos.txt)
    </text>
    
    <!-- Representación del archivo -->
    <rect x="665" y="135" width="170" height="190" fill="white" stroke="#666" stroke-width="1" rx="3"/>
    
    <!-- Contenido del archivo -->
    <g transform="translate(675, 150)">
      <rect x="0" y="0" width="150" height="18" fill="#C8E6C9" stroke="#2E7D32" stroke-width="1"/>
      <text x="5" y="13" font-family="monospace" font-size="10">Línea 1: datos...</text>
      
      <rect x="0" y="20" width="150" height="18" fill="#C8E6C9" stroke="#2E7D32" stroke-width="1"/>
      <text x="5" y="33" font-family="monospace" font-size="10">Línea 2: más info</text>
      
      <rect x="0" y="40" width="150" height="18" fill="#C8E6C9" stroke="#2E7D32" stroke-width="1"/>
      <text x="5" y="53" font-family="monospace" font-size="10">Línea 3: ...</text>
      
      <text x="75" y="75" font-family="Arial, sans-serif" font-size="12" text-anchor="middle">...</text>
      
      <rect x="0" y="85" width="150" height="18" fill="#C8E6C9" stroke="#2E7D32" stroke-width="1"/>
      <text x="5" y="98" font-family="monospace" font-size="10">Última línea</text>
      
      <text x="5" y="120" font-family="Arial, sans-serif" font-size="10" fill="#666">
        📍 Sistema operativo
      </text>
      <text x="5" y="135" font-family="Arial, sans-serif" font-size="10" fill="#666">
        gestiona el acceso
      </text>
      <text x="5" y="150" font-family="Arial, sans-serif" font-size="10" fill="#666">
        al disco físico
      </text>
    </g>
  </g>
  
  <!-- Nota importante -->
  <rect x="50" y="360" width="800" height="30" fill="#FFF9C4" stroke="#F9A825" stroke-width="2" rx="5"/>
  <text x="450" y="380" font-family="Arial, sans-serif" font-size="12" text-anchor="middle">
    💡 El puntero FILE* es tu único punto de acceso al archivo. Nunca manipules directamente la estructura FILE.
  </text>
  
  <!-- Definición de marcadores -->
  <defs>
    <marker id="arrow-green" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#2E7D32"/>
    </marker>
    <marker id="arrow-orange" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#F57C00"/>
    </marker>
  </defs>
</svg>
